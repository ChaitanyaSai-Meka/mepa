generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model users {
  id         Int      @id @default(autoincrement())
  username   String   @unique
  email      String   @unique
  password   String
  created_at DateTime @default(now())

  routes       routes[]
  saved_routes saved_routes[]
  history      history[]
  feedback     feedback[]

  @@map("users")
}

model stations {
  id                String  @id
  name              String
  parent_station_id String?
  line_name         String?
  latitude          Decimal @db.Decimal(10, 8)
  longitude         Decimal @db.Decimal(11, 8)

  parent_station      stations?  @relation("StationHierarchy", fields: [parent_station_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  child_stations      stations[] @relation("StationHierarchy")
  routes_as_start     routes[]   @relation("StartStation")
  routes_as_end       routes[]   @relation("EndStation")

  @@map("stations")
}

model routes {
  id               Int      @id @default(autoincrement())
  user_id          Int?
  route_name       String?
  start_station_id String
  end_station_id   String
  shortest_path    Json
  created_at       DateTime @default(now())

  user          users?         @relation(fields: [user_id], references: [id], onDelete: SetNull)
  start_station stations       @relation("StartStation", fields: [start_station_id], references: [id])
  end_station   stations       @relation("EndStation", fields: [end_station_id], references: [id])
  saved_routes  saved_routes[]
  history       history[]

  @@map("routes")
}

model saved_routes {
  id        Int      @id @default(autoincrement())
  user_id   Int
  route_id  Int
  saved_at  DateTime @default(now())

  user  users  @relation(fields: [user_id], references: [id], onDelete: Cascade)
  route routes @relation(fields: [route_id], references: [id], onDelete: Cascade)

  @@unique([user_id, route_id])
  @@map("saved_routes")
}

model history {
  id         Int      @id @default(autoincrement())
  user_id    Int
  route_id   Int
  viewed_at  DateTime @default(now())

  user  users  @relation(fields: [user_id], references: [id], onDelete: Cascade)
  route routes @relation(fields: [route_id], references: [id], onDelete: Cascade)

  @@map("history")
}

model feedback {
  id         Int      @id @default(autoincrement())
  user_id    Int?
  feedback   String   @db.Text
  created_at DateTime @default(now())

  user users? @relation(fields: [user_id], references: [id], onDelete: SetNull)

  @@map("feedback")
}
